<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Metrics Dashboard</title>

    <script
      crossorigin="anonymous"
      integrity="sha512-7i9wEYbrbsYuFcCvlOk0icJsijxfLfpUsOwh9J7S9baGIZKseOh8L/YMxM1v/PD9/J6PYxKcqmIYIsSQrZ5S7Q=="
      referrerpolicy="no-referrer"
      src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.30.0/plotly.min.js"
    ></script>

    <style>
      details {
        border: 1px solid;
        border-radius: 1ex;
        overflow: clip;
        padding: 1em;
      }

      details + details {
        margin: 1em 0;
      }

      details summary {
        cursor: pointer;
        list-style: none; /* remove the default marker */
      }

      details summary h2 {
        background: gainsboro;
        margin: -1em;
        padding: 1em;
        user-select: none;
      }

      details[open] summary h2 {
        margin-bottom: 1em;
      }

      input,
      textarea {
        flex-grow: 1;
        margin: 1em 0;
        padding: 5px;
      }
    </style>
  </head>

  <body style="margin: 0; min-height: 100vh; padding: 0">
    <header style="display: flex">
      <h1 style="flex-grow: 1">Metrics Dashboard</h1>

      <nav aria-label="admin menu" style="flex-grow: 0; padding: 1ex; text-align: right">
        <menu style="list-style-type: none; margin: 0; padding: 0"></menu>
      </nav>
    </header>

    <main style="display: none; padding: 0 1em">
      <details open>
        <summary><h2>Overview</h2></summary>

        <figure is="cc-project-overview">
          <img
            src="https://sonarcloud.io/api/project_badges/measure?project=visitingmedia_ttx-backend&metric=coverage&token=fd5a3fcced077e6507b1b610d0c88c64779b682d"
            alt="Coverage statistics for project"
          />
          <img
            src="https://sonarcloud.io/api/project_badges/measure?project=visitingmedia_ttx-frontend&metric=coverage&token=90307afb036ff0e039439001aeabc5197f394f7c"
            alt="Coverage statistics for project"
          />
        </figure>
      </details>

      <details>
        <summary><h2>Contribution Ratios</h2></summary>

        <p>
          <strong>Disclaimer:</strong>
          <em>
            Contribution ratios are only ever to be used to indicate that individuals are commenting on an equal number
            of pull requests as they are authoring. These ratios should never be used to compare individuals against
            others.
          </em>
        </p>

        <p>
          Each bar of each graph is showing the ratio of: comments on other contributors' pull requests (green) to
          authored pull requests (gray). The goal we should aim for is a completely green bar, meaning that we have
          commented on other peoples' pull requests at least as many times as we have asked for people to comment on our
          own pull requests.
        </p>

        <article id="ratios"></article>
      </details>

      <details>
        <summary><h2>Open Time</h2></summary>

        <article>
          <p>
            The purpose of this plot is to evaluate how long PRs take to get accepted. This plot is only considering:
            PRs that were "merged", and open for more than 1 day.
          </p>

          <div id="openTimeGraph" style="height: 800px; margin: 0 auto; width: 1400px"></div>
        </article>
      </details>
    </main>

    <dialog is="access-config" style="border-radius: 2ex; width: 30em">
      <h2>Access Config</h2>

      <label for="org">Organization Name</label>

      <div style="display: flex">
        <input id="org" style="flex-grow: 1" type="" />
      </div>

      <label for="repos">Repositories (name only; one per line)</label>

      <div style="display: flex">
        <textarea id="repos" style="height: 6em"></textarea>
      </div>

      <p>
        To use this application you will need to provide an API token for authenticated requests. This should be
        available in 1Password under the title "Github Token - TTX Dashboard". The token will be stored in localStorage
        between user sessions for convenience.
      </p>

      <label for="token">Token</label>

      <div style="display: flex">
        <textarea id="token" style="height: 6em"></textarea>
      </div>

      <div style="display: flex; justify-content: space-between">
        <button>Test token</button>
        <button>Save</button>
      </div>
    </dialog>

    <script src="./lib/global.js"></script>
    <script type="module" src="./init.mjs"></script>
  </body>
</html>
